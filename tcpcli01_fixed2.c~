#include	"unp.h"

void process(int sockfd)
{
  char	sendline[MAXLINE], file[30], temp[MAXLINE];
  int i, n;
  FILE *f;

  for (;;) {
    while (getchar() != '\n');
    printf("Nhap ten file: ");
    gets(file);
    f = fopen(file, "r");
    if (f == NULL) {
      printf("Khong mo duoc file\n");
      return;
    }
    strcpy(sendline, "");
    while (fgets(temp, MAXLINE, f) > 0)
      strcat(sendline, temp);
    fclose(f);
    Writen(sockfd, sendline, strlen(sendline));

  }
}

int
main(int argc, char **argv)
{
  int					sockfd;
  struct sockaddr_in	servaddr;

  if (argc != 2)
    err_quit("usage: tcpcli <IPaddress>");

  sockfd = Socket(AF_INET, SOCK_STREAM, 0);

  bzero(&servaddr, sizeof(servaddr));
  servaddr.sin_family = AF_INET;
  servaddr.sin_port = htons(SERV_PORT);
  Inet_pton(AF_INET, argv[1], &servaddr.sin_addr);

  Connect(sockfd, (SA *) &servaddr, sizeof(servaddr));

  process(sockfd);		/* do it all */

  exit(0);
}
